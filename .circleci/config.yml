version: 2.1
executors:
  basic:
    docker:
      - image: cimg/base:stable
    resource_class: small

parameters:
  sequential:
    type: boolean
    default: false
jobs: 
  build-a:
    executor: basic
    steps:
      - checkout
      - run: 
          name: Build A
          command: echo "hello"

  test-a:
    executor: basic
    steps:
      - checkout
      - run:
          name: Test A
          command: echo "this is a test job"

  test-b:
    executor: basic
    steps:
      - checkout
      - run:
          name: Test B
          command: echo "this is another test job"

  deploy-a:
    executor: basic
    steps:
      - checkout
      - run:
          name: Deploy A
          command: echo "this is a deploy job"
workflows:
  fan-workflow:
    jobs:
      - build-a
      - test-a:
          requires:
            - build-a
      - test-b:
          requires:
            - build-a 
      - deploy-a:
          requires:
            - test-a
            - test-b
  sequentialr-workflow:
    when: <<pipeline.parameter.sequential>>
    jobs:
      - build-a
      - build-b:
          requires:
            - build-a
      - test-a:
          requires:
            - build-a
            - build-b
      - test-b:
          requires:
            - build-a
            - build-b
            - test-a