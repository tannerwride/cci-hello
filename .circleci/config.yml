version: 2.1
jobs:
  test-and-build:
    machine:
      image: ubuntu-2004:current
    steps:
      - checkout
      - run:
          command: |
            go test
      - setup_remote_docker
      - run: 
          name: Build and Push Image
          command: | 
            docker build -t tannerdemoapp.azurecr.io/tannerdemoapp:latest .
            
workflows:
  build-and-push-workflow:
    jobs: 
      - test-and-build:
          context: azure
          
            
