version: 2.1
jobs:
  build-and-push:
    docker:
      - image: cimg/base:stable
    steps:
      - checkout
      - setup_remote_docker
      - run: 
          name: Build and Push Image
          command: | 
            docker build -t tannerdemoapp.azurecr.io/tannerdemoapp:latest .
            docker login -u $ACR_USER -p $ACR_PASS tannerdemoapp.azurecr.io
            docker push tannerdemoapp.azurecr.io/tannerdemoapp:latest

workflows:
  build-and-push-workflow:
    jobs: 
      - build-and-push
          context: azure
            
